---
import { settings } from "@config/site.config.json";

import BlogCard from "@components/BlogCard.astro";
import PageHeader from "@components/PageHeader.astro";
import Pagination from "@components/Pagination.astro";
import Layout from '@layouts/Layout.astro';

import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

const allPosts: CollectionEntry<"blog">[] = (await getCollection("blog")).sort(
  (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
    b.data.date.valueOf() - a.data.date.valueOf()
);

const allAuthors: CollectionEntry<"author">[] = await getCollection("author");

const postsPerPage: number = settings?.pagination;
const totalPages: number = Math.ceil(allPosts.length / postsPerPage);
---

<Layout
  title={"Edward Deaver - All posts"}
  meta_title={""}
  description={""}
  image={""}
  author={""}
  keywords={""}
  noindex={false}
  canonical={""}
>

  <PageHeader title="All posts" />

  <!-- START :: All posts -->
  <section>
    <div class="container">
      <div class="row gy-6 gx-4">
        {allPosts.slice(0, settings?.pagination || 6).map((post) => (
          <div class="lg:col-6">
            <BlogCard post={post} allAuthors={allAuthors} />
          </div>
        ))}

        <div class="col-12">
          <Pagination totalPages={totalPages} currentPage={1} section="blog" />
        </div>
      </div>
    </div>
  </section>
  <!-- END :: All posts -->
</Layout>